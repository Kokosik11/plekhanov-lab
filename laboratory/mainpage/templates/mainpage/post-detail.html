{% load static %}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ post.title }}</title>
    <script src="https://code.iconify.design/1/1.0.6/iconify.min.js"></script>
    <link rel="stylesheet" href="{% static 'mainpage/css/blog.css' %}">
    <link rel="icon" type="image/png" href="/img/logo.ico">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="/img/profile-logo.svg" alt="logo">
            <h1>Аккаунт</h1>
        </div>

        <nav>
            <ul>
                <li class="menu"><a href="{% url 'blog' %}">Лаборатория</a></li>
                <li class="menu"><a href="{% url 'profile' %}">Профиль</a></li>
                <li class="menu gray">Здравствуйте, {{ user.first_name }}</li>
                <li class="menu avatar-menu">
                    <img src="{{ user.profile.image.url }}" width="42" alt="avatar">
                    <div class="hover-avatar"><span class="iconify" data-inline="false" data-icon="uil:exit"></span></div>
                </li>
            </ul>
        </nav>
    </header>
    
    <main>
        <section class="post">
            <article class="post-info">
                <time>{{ post.created_on }}</time>
                <div class="reading-time">
                    <img src="/img/Time Circle.svg" alt="Time Circle">
                    <span class="reading-text_gray">время чтения:</span>
                    <span class="reading-text_blue">1 мин</span>
                </div>
            </article>

            <article class="post-profile">
                <img src="{{ post.image.url }}" alt="image: post" id="post-image">

                <h2 class="post-title">{{ post.title }}</h2>
                <span class="post-text">
                  {{ post.content|safe }}
                </span>
            </article>
            <div class="line post-end"></div>
            <article class="post-tags">
                <img src="/img/tag.svg" alt="tag">
                {% for tag in post.tags.all %}
                <span><a href="{% url 'tagged' tag.slug %}">{{ tag }}</a></span>
                {% endfor %}
            </article>

            <article class="post-actions">
                <div class="actions-block" id="like-section">
                    {% include 'mainpage/likes.html' %}
                </div>

                <div class="actions-block">
                    <div class="comments">
                        <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path class="comments-svg" d="M2.478 10.6325L2.48113 10.6474C2.92713 12.7649 4.35416 14.5828 6.37377 15.5008L10.5 17.3763V15.1667H12.8333C16.055 15.1667 18.6667 12.555 18.6667 9.33333V8.16667C18.6667 4.94501 16.055 2.33333 12.8333 2.33333H8.16667C4.94501 2.33333 2.33333 4.94501 2.33333 8.16667V9.33333C2.33333 9.7771 2.38247 10.2066 2.47467 10.6177L2.478 10.6325ZM12.8333 21L5.40823 17.625C2.70418 16.3958 0.794815 13.9623 0.1979 11.1283C0.0683544 10.5507 0 9.95002 0 9.33333V8.16667C0 3.65634 3.65634 0 8.16667 0H12.8333C17.3437 0 21 3.65634 21 8.16667V9.33333C21 13.8437 17.3437 17.5 12.8333 17.5V21Z" fill="#648FFF"/>
                        </svg>
                            
                        <span>{{ comments.count }} комментарий</span>
                    </div>
                    <div class="views">
                        <svg width="29" height="24" viewBox="0 0 29 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path class="views-svg" fill-rule="evenodd" clip-rule="evenodd" d="M19.1137 11.6548C19.1137 14.2025 17.0476 16.2686 14.4999 16.2686C11.9523 16.2686 9.88611 14.2025 9.88611 11.6548C9.88611 9.1057 11.9523 7.04102 14.4999 7.04102C17.0476 7.04102 19.1137 9.1057 19.1137 11.6548Z" stroke="#648FFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path class="views-svg" fill-rule="evenodd" clip-rule="evenodd" d="M1 11.6547C1 16.4407 7.04377 22.3093 14.5 22.3093C21.9548 22.3093 28 16.445 28 11.6547C28 6.8643 21.9548 1 14.5 1C7.04377 1 1 6.86868 1 11.6547Z" stroke="#648FFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                            
                        <span>{{ post.views }}</span>
                    </div>
                    <div class="share">
                        <a href="http://vk.com/share.php?url=https://evileg.com/ru/{{ post.get_absolute_url }}"
                        onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"
                        target="_blank" rel="nofollow">
                        <img src="/img/social-icons/vkontakte.svg" alt="">
                        </a>
                        <a href="https://twitter.com/share?url=https://evileg.com/ru/{{ post.get_absolute_url }}"
                        onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"
                        target="_blank" rel="nofollow">
                        <img src="/img/social-icons/twitterok.svg" alt="">
                        </a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u=https://evileg.com/ru/{{ post.get_absolute_url }}"
                        onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"
                        target="_blank" rel="nofollow">
                        <img src="/img/social-icons/faceontable.svg" alt="">
                        </a>
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://evileg.com/ru/{{ post.get_absolute_url }}"
                        onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;"
                        target="_blank" rel="nofollow">
                        <img src="/img/social-icons/linkedin-post.svg" alt="">
                        </a>
                    </div>
                </div>
            </article>

            <article class="comments-block">
                <h3>Комментарии<span class="comment-count"> {{ comments.count }}</span></h3>
                <div class="line comment-start"></div>
                {% include 'mainpage/comments.html' %}
            </article>
        </section>
    </main>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).on('submit', '.submit_comment', function(event){
            event.preventDefault();
            console.log($(this).serialize());
            $.ajax({
                type: 'POST',
                url: $(this).attr('action'),
                data: $(this).serialize(),
                dataType: 'json',
                success: function(response) {
                    $('.comments-content').html(response['form']);
                    $('textarea').val('');
                },
                error: function(rs, e) {
                    console.log(rs.responseText);
                },
            });
        });
    </script>
    <script type="text/javascript">
        $(document).ready(function(event){
            $(document).on('click', '#like', function(event){
                event.preventDefault();
                var pk = $(this).attr('value');
                $.ajax({
                type: 'POST',
                url: '{% url "like_post" post.slug %}',
                data: {'id':pk, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
                dataType: 'json',
                success: function(response){
                    $('#like-section').html(response['form'])
                    console.log($('#like-section').html(response['form']));
                },
                error: function(rs, e){
                    console.log(rs.responseText);
                },
                });
            });
        });
    </script>
</body>
</html>